<div class="max-w-4xl mx-auto p-4 md:p-6">
  <h1 class="text-2xl font-bold text-gray-900 mb-6">Mon Profil</h1>
  
  <!-- Messages de succès/erreur -->
  @if (successMessage) {
    <div class="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg flex items-center">
      <i class="bi bi-check-circle text-green-600 mr-2"></i>
      <span class="text-green-800">{{ successMessage }}</span>
    </div>
  }
  @if (errorMessage) {
    <div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center">
      <i class="bi bi-exclamation-triangle text-red-600 mr-2"></i>
      <span class="text-red-800">{{ errorMessage }}</span>
    </div>
  }

  @if (currentUser) {
    <div class="space-y-6">
    <!-- Section Informations personnelles -->
    <div class="bg-white border border-gray-200 rounded-lg p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold text-gray-900">Informations personnelles</h2>
        <span 
          class="px-3 py-1 text-sm font-medium rounded-full"
          [ngClass]="{
            'bg-purple-100 text-purple-800': currentUser.role === 'admin',
            'bg-blue-100 text-blue-800': currentUser.role === 'user'
          }">
          {{ getRoleLabel() }}
        </span>
      </div>

      <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
        <div class="space-y-4">
          <!-- Pseudo -->
          <div class="flex flex-col sm:flex-row sm:items-center">
            <span class="text-sm font-medium text-gray-700 w-full sm:w-40 mb-1 sm:mb-0">Pseudo:</span>
            <span class="text-gray-900">{{ currentUser.pseudo }}</span>
          </div>

          <!-- Nom -->
          <div class="flex flex-col sm:flex-row sm:items-start">
            <span class="text-sm font-medium text-gray-700 w-full sm:w-40 mb-1 sm:mb-0 sm:pt-2">Nom:</span>
            <div class="flex-1">
              @if (editMode) {
                <input 
                  type="text" 
                  formControlName="nom" 
                  class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  [class.border-red-500]="profileForm.get('nom')?.invalid && profileForm.get('nom')?.touched"
                  [class.border-gray-300]="!(profileForm.get('nom')?.invalid && profileForm.get('nom')?.touched)"
                />
              }
              @if (!editMode) {
                <span class="text-gray-900">{{ currentUser.nom }}</span>
              }
            </div>
          </div>

          <!-- Prénom -->
          <div class="flex flex-col sm:flex-row sm:items-start">
            <span class="text-sm font-medium text-gray-700 w-full sm:w-40 mb-1 sm:mb-0 sm:pt-2">Prénom:</span>
            <div class="flex-1">
              @if (editMode) {
                <input 
                  type="text" 
                  formControlName="prenom" 
                  class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  [class.border-red-500]="profileForm.get('prenom')?.invalid && profileForm.get('prenom')?.touched"
                  [class.border-gray-300]="!(profileForm.get('prenom')?.invalid && profileForm.get('prenom')?.touched)"
                />
              }
              @if (!editMode) {
                <span class="text-gray-900">{{ currentUser.prenom }}</span>
              }
            </div>
          </div>

          <!-- Email -->
          <div class="flex flex-col sm:flex-row sm:items-start">
            <span class="text-sm font-medium text-gray-700 w-full sm:w-40 mb-1 sm:mb-0 sm:pt-2">Email:</span>
            <div class="flex-1">
              @if (editMode) {
                <input 
                  type="email" 
                  formControlName="email" 
                  class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  [class.border-red-500]="profileForm.get('email')?.invalid && profileForm.get('email')?.touched"
                  [class.border-gray-300]="!(profileForm.get('email')?.invalid && profileForm.get('email')?.touched)"
                />
              }
              @if (!editMode) {
                <span class="text-gray-900">{{ currentUser.email }}</span>
              }
            </div>
          </div>

          <!-- Compte -->
          <div class="flex flex-col sm:flex-row sm:items-center">
            <span class="text-sm font-medium text-gray-700 w-full sm:w-40 mb-1 sm:mb-0">Compte:</span>
            <span 
              class="inline-flex items-center px-2.5 py-0.5 text-sm font-medium rounded-full w-fit"
              [class.bg-green-100]="currentUser.actif"
              [class.text-green-800]="currentUser.actif"
              [class.bg-gray-100]="!currentUser.actif"
              [class.text-gray-800]="!currentUser.actif">
              {{ currentUser.actif ? 'Actif' : 'Inactif' }}
            </span>
          </div>

          <!-- Membre depuis -->
          @if (currentUser.dateCreation) {
            <div class="flex flex-col sm:flex-row sm:items-center">
              <span class="text-sm font-medium text-gray-700 w-full sm:w-40 mb-1 sm:mb-0">Membre depuis:</span>
              <span class="text-gray-900">{{ currentUser.dateCreation | date: 'dd/MM/yyyy' }}</span>
            </div>
          }
        </div>

        <!-- Boutons d'action -->
        <div class="flex gap-3 mt-6 pt-6 border-t border-gray-200">
          @if (!editMode) {
            <button 
              type="button" 
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
            (click)="toggleEditMode()">
            Modifier mes informations
          </button>
          }

          @if (editMode) {
            <button 
              type="submit" 
              class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
              [disabled]="profileForm.invalid || loading">
              {{ loading ? 'Enregistrement...' : 'Enregistrer' }}
            </button>
            <button 
              type="button" 
              class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              (click)="toggleEditMode()"
              [disabled]="loading">
              Annuler
            </button>
          }
        </div>
      </form>
    </div>

    <!-- Section Sécurité -->
    <div class="bg-white border border-gray-200 rounded-lg p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-6">Sécurité</h2>

      @if (!changePasswordMode) {
        <button 
        type="button" 
        class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
        (click)="toggleChangePasswordMode()">
        Changer mon mot de passe
      </button>
      }

      @if (changePasswordMode) {
        <form 
        [formGroup]="passwordForm" 
        (ngSubmit)="changePassword()"
        class="space-y-4">
        
        <!-- Ancien mot de passe -->
        <div>
          <label for="ancienMotDePasse" class="block text-sm font-medium text-gray-700 mb-2">
            Mot de passe actuel
          </label>
          <input 
            type="password" 
            id="ancienMotDePasse" 
            formControlName="ancienMotDePasse" 
            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            [class.border-red-500]="passwordForm.get('ancienMotDePasse')?.invalid && passwordForm.get('ancienMotDePasse')?.touched"
            [class.border-gray-300]="!(passwordForm.get('ancienMotDePasse')?.invalid && passwordForm.get('ancienMotDePasse')?.touched)"
          />
          @if (passwordForm.get('ancienMotDePasse')?.invalid && passwordForm.get('ancienMotDePasse')?.touched) {
            <p class="mt-1 text-sm text-red-600">
              Le mot de passe doit contenir au moins 6 caractères
            </p>
          }
        </div>

        <!-- Nouveau mot de passe -->
        <div>
          <label for="nouveauMotDePasse" class="block text-sm font-medium text-gray-700 mb-2">
            Nouveau mot de passe
          </label>
          <input 
            type="password" 
            id="nouveauMotDePasse" 
            formControlName="nouveauMotDePasse" 
            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            [class.border-red-500]="passwordForm.get('nouveauMotDePasse')?.invalid && passwordForm.get('nouveauMotDePasse')?.touched"
            [class.border-gray-300]="!(passwordForm.get('nouveauMotDePasse')?.invalid && passwordForm.get('nouveauMotDePasse')?.touched)"
          />
          @if (passwordForm.get('nouveauMotDePasse')?.invalid && passwordForm.get('nouveauMotDePasse')?.touched) {
            <p class="mt-1 text-sm text-red-600">
              Le mot de passe doit contenir au moins 6 caractères
            </p>
          }
        </div>

        <!-- Confirmer mot de passe -->
        <div>
          <label for="confirmMotDePasse" class="block text-sm font-medium text-gray-700 mb-2">
            Confirmer le nouveau mot de passe
          </label>
          <input 
            type="password" 
            id="confirmMotDePasse" 
            formControlName="confirmMotDePasse" 
            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            [class.border-red-500]="passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmMotDePasse')?.touched"
            [class.border-gray-300]="!(passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmMotDePasse')?.touched)"
          />
          @if (passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmMotDePasse')?.touched) {
            <p class="mt-1 text-sm text-red-600">
              Les mots de passe ne correspondent pas
            </p>
          }
        </div>

        <!-- Boutons d'action -->
        <div class="flex gap-3 pt-4">
          <button 
            type="submit" 
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
            [disabled]="passwordForm.invalid || loading">
            {{ loading ? 'Changement...' : 'Changer le mot de passe' }}
          </button>
          <button 
            type="button" 
            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            (click)="toggleChangePasswordMode()"
            [disabled]="loading">
            Annuler
          </button>
        </div>
      </form>
      }
    </div>
  </div>
  }

  <!-- Message si pas connecté -->
  @if (!currentUser) {
    <div class="bg-white border border-gray-200 rounded-lg p-8 text-center">
      <p class="text-gray-600 mb-4">Vous devez être connecté pour accéder à votre profil.</p>
      <a 
        routerLink="/auth/login" 
        class="inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
        Se connecter
      </a>
    </div>
  }
</div> 