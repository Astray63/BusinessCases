<div class="dashboard-container" *ngIf="currentUser && !loading">
  <!-- En-t√™te avec message de bienvenue -->
  <header class="dashboard-header">
    <div class="welcome-section">
      <h1 class="welcome-title">Bonjour, {{ currentUser.prenom }} üëã</h1>
      <p class="welcome-subtitle">Bienvenue sur votre tableau de bord</p>
    </div>
    <div class="user-badges">
      <span class="badge badge-role" [class.badge-admin]="currentUser.role === 'admin'">
        {{ currentUser.role === 'admin' ? 'üëë Administrateur' : 'üë§ Utilisateur' }}
      </span>
      <span class="badge badge-owner" *ngIf="isProprietaire">
        ‚ö° Propri√©taire
      </span>
    </div>
  </header>

  <!-- Section Statistiques Client -->
  <section class="stats-section client-section">
    <div class="section-header">
      <h2 class="section-title">
        <span class="icon">üîµ</span>
        Mes r√©servations
      </h2>
    </div>

    <div class="stats-grid">
      <div class="stat-card stat-card-primary">
        <div class="stat-icon">
          <i class="bi bi-calendar-check"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ dashboardStats?.clientStats?.totalReservations || 0 }}</div>
          <div class="stat-label">R√©servations totales</div>
          <div class="stat-sublabel">
            {{ dashboardStats?.clientStats?.reservationsCeMois || 0 }} ce mois-ci
          </div>
        </div>
      </div>

      <div class="stat-card stat-card-success">
        <div class="stat-icon">
          <i class="bi bi-lightning-charge-fill"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ dashboardStats?.clientStats?.reservationsEnCours || 0 }}</div>
          <div class="stat-label">Actives</div>
          <div class="stat-sublabel">En cours d'utilisation</div>
        </div>
      </div>

      <div class="stat-card stat-card-info">
        <div class="stat-icon">
          <i class="bi bi-check-circle-fill"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ dashboardStats?.clientStats?.reservationsTerminees || 0 }}</div>
          <div class="stat-label">Termin√©es</div>
          <div class="stat-sublabel">Compl√©t√©es avec succ√®s</div>
        </div>
      </div>

      <div class="stat-card stat-card-warning">
        <div class="stat-icon">
          <i class="bi bi-wallet2"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ dashboardStats?.clientStats?.montantMoisEnCours | currency:'EUR':'symbol':'1.0-0' }}</div>
          <div class="stat-label">D√©penses du mois</div>
          <div class="stat-sublabel">
            Total: {{ dashboardStats?.clientStats?.montantTotalDepense | currency:'EUR':'symbol':'1.0-0' }}
          </div>
        </div>
      </div>
    </div>

    <!-- Prochaine r√©servation -->
    <div class="next-reservation-card" *ngIf="dashboardStats?.clientStats?.prochaineReservation">
      <div class="card-header">
        <h3>üéØ Prochaine r√©servation</h3>
      </div>
      <div class="card-body">
        <div class="reservation-info">
          <p><strong>Borne:</strong> {{ dashboardStats?.clientStats?.prochaineReservation?.borne?.nom }}</p>
          <p><strong>Lieu:</strong> {{ dashboardStats?.clientStats?.prochaineReservation?.borne?.localisation }}</p>
          <p><strong>D√©but:</strong> {{ dashboardStats?.clientStats?.prochaineReservation?.dateDebut | date:'dd/MM/yyyy √† HH:mm' }}</p>
          <p><strong>Fin:</strong> {{ dashboardStats?.clientStats?.prochaineReservation?.dateFin | date:'dd/MM/yyyy √† HH:mm' }}</p>
        </div>
      </div>
    </div>

    <!-- Actions rapides Client -->
    <div class="quick-actions">
      <button class="action-btn action-btn-primary" (click)="reserverBorne()">
        <i class="bi bi-search"></i>
        <span>Rechercher une borne</span>
      </button>
      <button class="action-btn action-btn-secondary" (click)="voirMesReservations()">
        <i class="bi bi-list-ul"></i>
        <span>Voir toutes mes r√©servations</span>
      </button>
    </div>
  </section>

  <!-- Section Propri√©taire -->
  <section class="stats-section owner-section" *ngIf="isProprietaire && dashboardStats?.ownerStats">
    <div class="section-header">
      <h2 class="section-title">
        <span class="icon">üü¢</span>
        Mes bornes de recharge
      </h2>
    </div>

    <div class="stats-grid">
      <div class="stat-card stat-card-purple">
        <div class="stat-icon">
          <i class="bi bi-ev-station-fill"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ dashboardStats?.ownerStats?.totalBornes }}</div>
          <div class="stat-label">Bornes totales</div>
          <div class="stat-sublabel">
            {{ dashboardStats?.ownerStats?.bornesDisponibles }} disponibles
          </div>
        </div>
      </div>

      <div class="stat-card stat-card-revenue">
        <div class="stat-icon">
          <i class="bi bi-currency-euro"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ dashboardStats?.ownerStats?.revenusEstimesMois | currency:'EUR':'symbol':'1.0-0' }}</div>
          <div class="stat-label">Revenus ce mois</div>
          <div class="stat-sublabel">
            Total: {{ dashboardStats?.ownerStats?.revenusTotaux | currency:'EUR':'symbol':'1.0-0' }}
          </div>
        </div>
      </div>

      <div class="stat-card stat-card-alert">
        <div class="stat-icon">
          <i class="bi bi-inbox-fill"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ dashboardStats?.ownerStats?.demandesEnAttente }}</div>
          <div class="stat-label">Demandes en attente</div>
          <div class="stat-sublabel">√Ä traiter rapidement</div>
        </div>
      </div>

      <div class="stat-card stat-card-teal">
        <div class="stat-icon">
          <i class="bi bi-graph-up-arrow"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ dashboardStats?.ownerStats?.tauxOccupationMoyen }}%</div>
          <div class="stat-label">Taux d'occupation</div>
          <div class="stat-sublabel">
            {{ dashboardStats?.ownerStats?.totalReservations }} r√©servations
          </div>
        </div>
      </div>
    </div>

    <!-- √âtat des bornes -->
    <div class="bornes-status-grid">
      <div class="status-item status-disponible">
        <div class="status-count">{{ dashboardStats?.ownerStats?.bornesDisponibles }}</div>
        <div class="status-label">Disponibles</div>
      </div>
      <div class="status-item status-occupee">
        <div class="status-count">{{ dashboardStats?.ownerStats?.bornesOccupees }}</div>
        <div class="status-label">Occup√©es</div>
      </div>
      <div class="status-item status-maintenance">
        <div class="status-count">{{ dashboardStats?.ownerStats?.bornesMaintenance }}</div>
        <div class="status-label">En maintenance</div>
      </div>
      <div class="status-item status-hors-service">
        <div class="status-count">{{ dashboardStats?.ownerStats?.bornesHorsService }}</div>
        <div class="status-label">Hors service</div>
      </div>
    </div>

    <!-- Borne la plus populaire -->
    <div class="popular-borne-card" *ngIf="dashboardStats?.ownerStats?.borneLaPlusReservee">
      <div class="card-header">
        <h3>‚≠ê Borne la plus r√©serv√©e</h3>
      </div>
      <div class="card-body">
        <div class="borne-info">
          <p><strong>Nom:</strong> {{ dashboardStats?.ownerStats?.borneLaPlusReservee?.nom }}</p>
          <p><strong>Localisation:</strong> {{ dashboardStats?.ownerStats?.borneLaPlusReservee?.localisation }}</p>
          <p><strong>Puissance:</strong> {{ dashboardStats?.ownerStats?.borneLaPlusReservee?.puissance }} kW</p>
          <p><strong>Prix:</strong> {{ dashboardStats?.ownerStats?.borneLaPlusReservee?.prixALaMinute | currency:'EUR':'symbol':'1.2-2' }}/min</p>
        </div>
      </div>
    </div>

    <!-- Actions rapides Propri√©taire -->
    <div class="quick-actions">
      <button class="action-btn action-btn-success" (click)="ajouterBorne()">
        <i class="bi bi-plus-circle-fill"></i>
        <span>Ajouter une borne</span>
      </button>
      <button class="action-btn action-btn-primary" (click)="voirMesBornes()">
        <i class="bi bi-lightning-charge"></i>
        <span>G√©rer mes bornes</span>
      </button>
      <button class="action-btn action-btn-secondary" (click)="voirDemandesReservation()">
        <i class="bi bi-inbox"></i>
        <span>Voir les demandes</span>
      </button>
    </div>
  </section>

  <!-- Call to Action - Devenir propri√©taire -->
  <section class="cta-section" *ngIf="!isProprietaire">
    <div class="cta-card">
      <div class="cta-icon">üí°</div>
      <div class="cta-content">
        <h2>Vous poss√©dez une borne de recharge ?</h2>
        <p>Mettez-la en location et g√©n√©rez des revenus passifs tout en aidant la communaut√© !</p>
        <button class="cta-btn" (click)="devenirProprietaire()">
          <i class="bi bi-lightning-charge-fill"></i>
          Devenir propri√©taire
        </button>
      </div>
      <div class="cta-benefits">
        <div class="benefit-item">
          <i class="bi bi-check-circle-fill"></i>
          <span>Revenus compl√©mentaires</span>
        </div>
        <div class="benefit-item">
          <i class="bi bi-check-circle-fill"></i>
          <span>Gestion simplifi√©e</span>
        </div>
        <div class="benefit-item">
          <i class="bi bi-check-circle-fill"></i>
          <span>Impact √©cologique positif</span>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Loading State -->
<div class="loading-state" *ngIf="loading">
  <div class="spinner-wrapper">
    <div class="spinner"></div>
    <p>Chargement de votre tableau de bord...</p>
  </div>
</div>

<!-- Empty State -->
<div class="empty-state" *ngIf="!currentUser && !loading">
  <div class="empty-icon">üîí</div>
  <h2>Acc√®s non autoris√©</h2>
  <p>Veuillez vous connecter pour acc√©der √† votre tableau de bord.</p>
  <button class="btn-login" routerLink="/auth/login">
    Se connecter
  </button>
</div>
