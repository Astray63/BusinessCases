<div class="borne-form-container">
  <div class="page-header">
    <h1>{{ pageTitle }}</h1>
    <button class="btn btn-secondary" (click)="cancel()">
      <i class="bi bi-arrow-left"></i> Retour
    </button>
  </div>

  <div class="form-card">
    <form [formGroup]="borneForm" (ngSubmit)="onSubmit()">
      <!-- Sélection du lieu -->
      <div class="form-section">
        <h3>Emplacement</h3>
        
        <div class="form-group">
          <label for="lieuId">Lieu de recharge <span class="required">*</span></label>
          <select
            id="lieuId"
            class="form-control"
            formControlName="lieuId"
            (change)="onLieuChange($event)"
            [class.is-invalid]="borneForm.get('lieuId')?.invalid && borneForm.get('lieuId')?.touched"
          >
            <option value="">Sélectionnez un lieu</option>
            <option *ngFor="let lieu of lieux" [value]="lieu.idLieu">
              {{ lieu.nom }} - {{ lieu.ville }}
            </option>
          </select>
          <div class="invalid-feedback" *ngIf="borneForm.get('lieuId')?.invalid && borneForm.get('lieuId')?.touched">
            Veuillez sélectionner un lieu
          </div>
          <small class="form-text">
            Vous n'avez pas de lieu ? 
            <a routerLink="/proprietaire/mes-lieux/ajouter">Créez-en un maintenant</a>
          </small>
        </div>

        <div class="form-group">
          <label for="localisation">Localisation <span class="required">*</span></label>
          <input
            type="text"
            id="localisation"
            class="form-control"
            formControlName="localisation"
            placeholder="Ex: 12 Rue de la République, Paris"
            [class.is-invalid]="borneForm.get('localisation')?.invalid && borneForm.get('localisation')?.touched"
          />
          <div class="invalid-feedback" *ngIf="borneForm.get('localisation')?.invalid && borneForm.get('localisation')?.touched">
            La localisation est obligatoire
          </div>
        </div>
      </div>

      <!-- Caractéristiques techniques -->
      <div class="form-section">
        <h3>Caractéristiques techniques</h3>
        
        <div class="form-group">
          <label for="type">Type de connecteur <span class="required">*</span></label>
          <select
            id="type"
            class="form-control"
            formControlName="type"
            [class.is-invalid]="borneForm.get('type')?.invalid && borneForm.get('type')?.touched"
          >
            <option *ngFor="let type of typesConnecteur" [value]="type.value">
              {{ type.label }}
            </option>
          </select>
          <div class="invalid-feedback" *ngIf="borneForm.get('type')?.invalid && borneForm.get('type')?.touched">
            Le type de connecteur est obligatoire
          </div>
        </div>

        <div class="form-group">
          <label for="puissance">Puissance <span class="required">*</span></label>
          <select
            id="puissance"
            class="form-control"
            formControlName="puissance"
            [class.is-invalid]="borneForm.get('puissance')?.invalid && borneForm.get('puissance')?.touched"
          >
            <option *ngFor="let niveau of niveauxPuissance" [value]="niveau.value">
              {{ niveau.label }}
            </option>
          </select>
          <div class="invalid-feedback" *ngIf="borneForm.get('puissance')?.invalid && borneForm.get('puissance')?.touched">
            La puissance est obligatoire
          </div>
        </div>

        <div class="form-group">
          <label for="etat">État <span class="required">*</span></label>
          <select
            id="etat"
            class="form-control"
            formControlName="etat"
          >
            <option value="DISPONIBLE">Disponible</option>
            <option value="OCCUPE">Occupée</option>
            <option value="HORS_SERVICE">Hors service</option>
          </select>
        </div>
      </div>

      <!-- Tarification -->
      <div class="form-section">
        <h3>Tarification</h3>
        
        <div class="form-group">
          <label for="prix">Prix par heure (€) <span class="required">*</span></label>
          <div class="input-group">
            <input
              type="number"
              id="prix"
              class="form-control"
              formControlName="prix"
              placeholder="0.00"
              step="0.01"
              min="0"
              [class.is-invalid]="borneForm.get('prix')?.invalid && borneForm.get('prix')?.touched"
            />
            <span class="input-group-text">€/h</span>
          </div>
          <div class="invalid-feedback" *ngIf="borneForm.get('prix')?.invalid && borneForm.get('prix')?.touched">
            Le prix est obligatoire et doit être positif
          </div>
          <small class="form-text">
            Prix recommandé : 2-5 €/h pour charge standard, 5-10 €/h pour charge rapide
          </small>
        </div>
      </div>

      <!-- Coordonnées GPS (automatique) -->
      <div class="form-section">
        <h3>Coordonnées GPS</h3>
        
        <div class="alert alert-info">
          <i class="bi bi-info-circle"></i>
          Les coordonnées GPS sont automatiquement récupérées depuis le lieu sélectionné.
        </div>

        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="latitude">Latitude</label>
            <input
              type="number"
              id="latitude"
              class="form-control"
              formControlName="latitude"
              placeholder="48.8566"
              step="0.000001"
              readonly
            />
          </div>
          
          <div class="form-group col-md-6">
            <label for="longitude">Longitude</label>
            <input
              type="number"
              id="longitude"
              class="form-control"
              formControlName="longitude"
              placeholder="2.3522"
              step="0.000001"
              readonly
            />
          </div>
        </div>
      </div>

      <!-- Boutons d'action -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="loading">
          Annuler
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="loading || borneForm.invalid">
          <span *ngIf="!loading">
            <i class="bi bi-check-lg"></i>
            {{ isEditMode ? 'Mettre à jour' : 'Créer la borne' }}
          </span>
          <span *ngIf="loading">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Enregistrement...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>
