<header class="bg-white border-b border-gray-200 sticky top-0 z-50">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <a routerLink="/" class="flex items-center gap-2 no-underline transition-opacity duration-200 hover:opacity-80">
          <i class="bi bi-lightning-charge-fill text-2xl text-blue-600"></i>
          <span class="text-xl font-bold text-gray-900 hidden sm:inline">Electricity Business</span>
          <span class="text-xl font-bold text-gray-900 sm:hidden">EB</span>
        </a>
      </div>
      
      <!-- Navigation Desktop -->
      <nav class="hidden xl:flex items-center gap-2">
        <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" 
           class="flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium text-gray-700 transition-colors duration-200 hover:bg-gray-100"
           [class.bg-blue-50]="router.url === '/'"
           [class.text-blue-600]="router.url === '/'"
           [class.font-semibold]="router.url === '/'">
          <i class="bi bi-house-fill"></i>
          <span>Accueil</span>
        </a>
        
        <!-- Non connecté -->
        <ng-container *ngIf="!currentUser">
          <a routerLink="/auth/login" 
             class="flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium text-gray-700 transition-colors duration-200 hover:bg-gray-100"
             [class.bg-blue-50]="router.url === '/auth/login'"
             [class.text-blue-600]="router.url === '/auth/login'">
            <i class="bi bi-box-arrow-in-right"></i>
            <span>Connexion</span>
          </a>
          <a routerLink="/auth/register" 
             class="flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700">
            <i class="bi bi-person-plus-fill"></i>
            <span>Inscription</span>
          </a>
        </ng-container>
        
        <!-- Connecté -->
        <ng-container *ngIf="currentUser">
          <!-- Espace Client avec sous-menu -->
          <div class="relative submenu-trigger">
            <button 
              class="flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200"
              [class.bg-blue-50]="router.url.includes('/client') || isClientMenuOpen"
              [class.text-blue-600]="router.url.includes('/client') || isClientMenuOpen"
              [class.text-gray-700]="!router.url.includes('/client') && !isClientMenuOpen"
              [class.hover:bg-gray-100]="!router.url.includes('/client') && !isClientMenuOpen"
              (click)="toggleClientMenu($event)">
              <i class="bi bi-person-fill"></i>
              <span>Espace Client</span>
              <i class="bi bi-chevron-down text-xs transition-transform duration-200" [class.rotate-180]="isClientMenuOpen"></i>
            </button>
            
            <!-- Dropdown Espace Client -->
            <div *ngIf="isClientMenuOpen" class="absolute left-0 top-full mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 animate-slideDown z-50">
              <a routerLink="/dashboard" (click)="closeAllMenus()"
                 class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors duration-200"
                 [class.bg-blue-50]="router.url === '/dashboard'"
                 [class.text-blue-600]="router.url === '/dashboard'">
                <i class="bi bi-speedometer2"></i>
                <span>Mon tableau de bord</span>
              </a>
              
              <a routerLink="/client/recherche" (click)="closeAllMenus()"
                 class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors duration-200"
                 [class.bg-blue-50]="router.url.includes('/client/recherche')"
                 [class.text-blue-600]="router.url.includes('/client/recherche')">
                <i class="bi bi-search"></i>
                <span>Rechercher une borne</span>
              </a>
              
              <a routerLink="/client/mes-reservations" (click)="closeAllMenus()"
                 class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors duration-200"
                 [class.bg-blue-50]="router.url.includes('/client/mes-reservations')"
                 [class.text-blue-600]="router.url.includes('/client/mes-reservations')">
                <i class="bi bi-calendar-check-fill"></i>
                <span>Mes réservations</span>
              </a>
            </div>
          </div>
          
          <!-- Espace Propriétaire avec sous-menu -->
          <div class="relative submenu-trigger">
            <button 
              class="flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200"
              [class.bg-orange-50]="router.url.includes('/proprietaire') || isProprietaireMenuOpen"
              [class.text-orange-600]="router.url.includes('/proprietaire') || isProprietaireMenuOpen"
              [class.text-gray-700]="!router.url.includes('/proprietaire') && !isProprietaireMenuOpen"
              [class.hover:bg-gray-100]="!router.url.includes('/proprietaire') && !isProprietaireMenuOpen"
              (click)="toggleProprietaireMenu($event)">
              <i class="bi bi-lightning-charge-fill"></i>
              <span>Espace Propriétaire</span>
              <span *ngIf="nombreBornes > 0" class="px-1.5 py-0.5 text-xs bg-orange-100 text-orange-700 rounded-full font-medium">
                {{ nombreBornes }}
              </span>
              <i class="bi bi-chevron-down text-xs transition-transform duration-200" [class.rotate-180]="isProprietaireMenuOpen"></i>
            </button>
            
            <!-- Dropdown Espace Propriétaire -->
            <div *ngIf="isProprietaireMenuOpen" class="absolute left-0 top-full mt-2 w-60 bg-white rounded-lg shadow-lg border border-gray-200 py-2 animate-slideDown z-50">
              <a routerLink="/proprietaire/dashboard" (click)="closeAllMenus()"
                 class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors duration-200"
                 [class.bg-orange-50]="router.url.includes('/proprietaire/dashboard')"
                 [class.text-orange-600]="router.url.includes('/proprietaire/dashboard')">
                <i class="bi bi-speedometer"></i>
                <span>Dashboard propriétaire</span>
              </a>
              
              <a routerLink="/proprietaire/mes-lieux" (click)="closeAllMenus()"
                 class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors duration-200"
                 [class.bg-orange-50]="router.url.includes('/proprietaire/mes-lieux')"
                 [class.text-orange-600]="router.url.includes('/proprietaire/mes-lieux')">
                <i class="bi bi-geo-alt-fill"></i>
                <span>Gérer mes lieux</span>
              </a>
              
              <a routerLink="/proprietaire/mes-bornes" (click)="closeAllMenus()"
                 class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors duration-200"
                 [class.bg-orange-50]="router.url.includes('/proprietaire/mes-bornes')"
                 [class.text-orange-600]="router.url.includes('/proprietaire/mes-bornes')">
                <i class="bi bi-lightning-charge-fill"></i>
                <span>Gérer mes bornes</span>
                <span *ngIf="nombreBornes > 0" class="ml-auto px-1.5 py-0.5 text-xs bg-orange-100 text-orange-700 rounded-full font-medium">
                  {{ nombreBornes }}
                </span>
              </a>
              
              <div class="border-t border-gray-200 my-2"></div>
              
              <a routerLink="/proprietaire/demandes" (click)="closeAllMenus()"
                 class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors duration-200"
                 [class.bg-orange-50]="router.url.includes('/proprietaire/demandes')"
                 [class.text-orange-600]="router.url.includes('/proprietaire/demandes')">
                <i class="bi bi-inbox-fill"></i>
                <span>Demandes de réservation</span>
              </a>
              
              <a routerLink="/proprietaire/historique" (click)="closeAllMenus()"
                 class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors duration-200"
                 [class.bg-orange-50]="router.url.includes('/proprietaire/historique')"
                 [class.text-orange-600]="router.url.includes('/proprietaire/historique')">
                <i class="bi bi-clock-history"></i>
                <span>Historique des réservations</span>
              </a>
            </div>
          </div>
          
          <!-- Menu utilisateur -->
          <div class="relative dropdown">
            <button 
              class="flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium text-gray-700 transition-colors duration-200 hover:bg-gray-100"
              (click)="toggleDropdown($event)">
              <i class="bi bi-person-circle text-lg"></i>
              <span>{{ currentUser.prenom }}</span>
              <i class="bi bi-chevron-down text-xs transition-transform duration-200" [class.rotate-180]="isDropdownOpen"></i>
            </button>
            
            <!-- Dropdown menu -->
            <div *ngIf="isDropdownOpen" class="absolute right-0 top-full mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 animate-slideDown z-50">
              <!-- User info -->
              <div class="px-4 py-3 border-b border-gray-200">
                <p class="text-sm font-semibold text-gray-900">{{ currentUser.prenom }} {{ currentUser.nom }}</p>
                <p class="text-xs text-gray-500">{{ currentUser.email }}</p>
                <span class="inline-block mt-2 px-2 py-1 text-xs font-medium rounded-full"
                      [class.bg-blue-100]="currentUser.role === 'user'"
                      [class.text-blue-700]="currentUser.role === 'user'"
                      [class.bg-purple-100]="currentUser.role === 'admin'"
                      [class.text-purple-700]="currentUser.role === 'admin'">
                  {{ currentUser.role === 'admin' ? 'Administrateur' : 'Utilisateur' }}
                </span>
              </div>
              
              <!-- Menu items -->
              <a routerLink="/profile" (click)="closeAllMenus()"
                 class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200">
                <i class="bi bi-person-fill text-blue-600"></i>
                <span>Mon profil</span>
              </a>
              
              <!-- Admin -->
              <a *ngIf="currentUser.role === 'admin'" routerLink="/admin" (click)="closeAllMenus()"
                 class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-purple-50 hover:text-purple-600 transition-colors duration-200">
                <i class="bi bi-shield-fill-check text-purple-600"></i>
                <span>Administration</span>
              </a>
              
              <!-- Logout -->
              <div class="border-t border-gray-200 my-2"></div>
              <button (click)="logout()" 
                 class="flex items-center gap-3 px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 transition-colors duration-200 w-full text-left">
                <i class="bi bi-box-arrow-right"></i>
                <span>Déconnexion</span>
              </button>
            </div>
          </div>
        </ng-container>
      </nav>
      
      <!-- Bouton menu mobile -->
      <button class="xl:hidden p-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200" 
              (click)="toggleMenu()" 
              aria-label="Toggle menu">
        <svg *ngIf="!isMenuOpen" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
        <svg *ngIf="isMenuOpen" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    
    <!-- Menu mobile -->
    <nav *ngIf="isMenuOpen" class="xl:hidden py-4 border-t border-gray-200 animate-slideDown">
      <div class="space-y-1">
        <a routerLink="/" (click)="closeMenu()"
           class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200"
           [class.bg-blue-50]="router.url === '/'"
           [class.text-blue-600]="router.url === '/'"
           [class.text-gray-700]="router.url !== '/'"
           [class.hover:bg-gray-100]="router.url !== '/'">
          <i class="bi bi-house-fill"></i>
          <span>Accueil</span>
        </a>
        
        <!-- Mobile - Non connecté -->
        <ng-container *ngIf="!currentUser">
          <a routerLink="/auth/login" (click)="closeMenu()"
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200"
             [class.bg-blue-50]="router.url === '/auth/login'"
             [class.text-blue-600]="router.url === '/auth/login'"
             [class.text-gray-700]="router.url !== '/auth/login'"
             [class.hover:bg-gray-100]="router.url !== '/auth/login'">
            <i class="bi bi-box-arrow-in-right"></i>
            <span>Connexion</span>
          </a>
          <a routerLink="/auth/register" (click)="closeMenu()"
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 transition-colors duration-200">
            <i class="bi bi-person-plus-fill"></i>
            <span>Inscription</span>
          </a>
        </ng-container>
        
        <!-- Mobile - Connecté -->
        <ng-container *ngIf="currentUser">
          <div class="px-4 py-3 bg-gray-50 rounded-lg mb-2">
            <p class="text-sm font-semibold text-gray-900">{{ currentUser.prenom }} {{ currentUser.nom }}</p>
            <p class="text-xs text-gray-600">{{ currentUser.email }}</p>
          </div>
          
          <!-- Section Client -->
          <div class="px-4 py-2">
            <p class="text-xs font-semibold text-gray-500 uppercase">Espace Client</p>
          </div>
          
          <a routerLink="/client/recherche" (click)="closeMenu()"
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200"
             [class.bg-blue-50]="router.url.includes('/client/recherche')"
             [class.text-blue-600]="router.url.includes('/client/recherche')"
             [class.text-gray-700]="!router.url.includes('/client/recherche')"
             [class.hover:bg-gray-100]="!router.url.includes('/client/recherche')">
            <i class="bi bi-search"></i>
            <span>Rechercher une borne</span>
          </a>
          
          <a routerLink="/client/mes-reservations" (click)="closeMenu()"
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200"
             [class.bg-blue-50]="router.url.includes('/client/mes-reservations')"
             [class.text-blue-600]="router.url.includes('/client/mes-reservations')"
             [class.text-gray-700]="!router.url.includes('/client/mes-reservations')"
             [class.hover:bg-gray-100]="!router.url.includes('/client/mes-reservations')">
            <i class="bi bi-calendar-check-fill"></i>
            <span>Mes réservations</span>
          </a>
          
          <a routerLink="/dashboard" (click)="closeMenu()"
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200"
             [class.bg-blue-50]="router.url.includes('/dashboard') && !router.url.includes('/proprietaire')"
             [class.text-blue-600]="router.url.includes('/dashboard') && !router.url.includes('/proprietaire')"
             [class.text-gray-700]="!router.url.includes('/dashboard') || router.url.includes('/proprietaire')"
             [class.hover:bg-gray-100]="!router.url.includes('/dashboard') || router.url.includes('/proprietaire')">
            <i class="bi bi-speedometer2"></i>
            <span>Mon tableau de bord</span>
          </a>
          
          <a routerLink="/profile" (click)="closeMenu()"
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200"
             [class.bg-blue-50]="router.url.includes('/profile')"
             [class.text-blue-600]="router.url.includes('/profile')"
             [class.text-gray-700]="!router.url.includes('/profile')"
             [class.hover:bg-gray-100]="!router.url.includes('/profile')">
            <i class="bi bi-person-fill"></i>
            <span>Mon profil</span>
          </a>
          
          <!-- Section Propriétaire -->
          <div class="border-t border-gray-200 my-2"></div>
          <div class="px-4 py-2 flex items-center justify-between">
            <p class="text-xs font-semibold text-orange-600 uppercase">Espace Propriétaire</p>
            <span *ngIf="nombreBornes > 0" class="px-2 py-0.5 text-xs bg-orange-100 text-orange-600 rounded-full font-medium">
              {{ nombreBornes }}
            </span>
          </div>
          
          <a routerLink="/proprietaire/dashboard" (click)="closeMenu()"
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200"
             [class.bg-orange-50]="router.url.includes('/proprietaire/dashboard')"
             [class.text-orange-600]="router.url.includes('/proprietaire/dashboard')"
             [class.text-gray-700]="!router.url.includes('/proprietaire/dashboard')"
             [class.hover:bg-orange-50]="!router.url.includes('/proprietaire/dashboard')">
            <i class="bi bi-speedometer"></i>
            <span>Dashboard propriétaire</span>
          </a>
          
          <a routerLink="/proprietaire/mes-lieux" (click)="closeMenu()"
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200"
             [class.bg-orange-50]="router.url.includes('/proprietaire/mes-lieux')"
             [class.text-orange-600]="router.url.includes('/proprietaire/mes-lieux')"
             [class.text-gray-700]="!router.url.includes('/proprietaire/mes-lieux')"
             [class.hover:bg-orange-50]="!router.url.includes('/proprietaire/mes-lieux')">
            <i class="bi bi-geo-alt-fill"></i>
            <span>Gérer mes lieux</span>
          </a>
          
          <a routerLink="/proprietaire/mes-bornes" (click)="closeMenu()"
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200"
             [class.bg-orange-50]="router.url.includes('/proprietaire/mes-bornes')"
             [class.text-orange-600]="router.url.includes('/proprietaire/mes-bornes')"
             [class.text-gray-700]="!router.url.includes('/proprietaire/mes-bornes')"
             [class.hover:bg-orange-50]="!router.url.includes('/proprietaire/mes-bornes')">
            <i class="bi bi-lightning-charge-fill"></i>
            <span>Gérer mes bornes</span>
          </a>
          
          <a routerLink="/proprietaire/demandes" (click)="closeMenu()"
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200"
             [class.bg-orange-50]="router.url.includes('/proprietaire/demandes')"
             [class.text-orange-600]="router.url.includes('/proprietaire/demandes')"
             [class.text-gray-700]="!router.url.includes('/proprietaire/demandes')"
             [class.hover:bg-orange-50]="!router.url.includes('/proprietaire/demandes')">
            <i class="bi bi-inbox-fill"></i>
            <span>Demandes reçues</span>
          </a>
          
          <a routerLink="/proprietaire/historique" (click)="closeMenu()"
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200"
             [class.bg-orange-50]="router.url.includes('/proprietaire/historique')"
             [class.text-orange-600]="router.url.includes('/proprietaire/historique')"
             [class.text-gray-700]="!router.url.includes('/proprietaire/historique')"
             [class.hover:bg-orange-50]="!router.url.includes('/proprietaire/historique')">
            <i class="bi bi-clock-history"></i>
            <span>Historique</span>
          </a>
          
          <!-- Mobile - Admin -->
          <a *ngIf="currentUser.role === 'admin'" routerLink="/admin" (click)="closeMenu()"
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors duration-200">
            <i class="bi bi-shield-fill-check text-red-600"></i>
            <span>Administration</span>
          </a>
          
          <!-- Mobile - Logout -->
          <div class="border-t border-gray-200 my-2"></div>
          <button (click)="logout()" 
             class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50 transition-colors duration-200 w-full text-left">
            <i class="bi bi-box-arrow-right"></i>
            <span>Déconnexion</span>
          </button>
        </ng-container>
      </div>
    </nav>
  </div>
</header> 